<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Liste des entreprises</title>
    <style>
        body{font-family:Arial,Helvetica,sans-serif;background:#f7f9fc;margin:0;padding:20px;color:#111}
        .box{max-width:800px;margin:0 auto;background:#fff;padding:16px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
        h1{margin:0 0 12px 0;font-size:1.25rem}
        ul{padding-left:0;margin:8px 0;list-style:none}
        li{margin:6px 0;padding:8px 10px;border-bottom:1px solid #eef2f7;display:flex;justify-content:space-between;align-items:center}
        .muted{color:#6b7280;font-size:0.95rem}
        .empty{color:#6b7280;padding:12px;text-align:center}

        /* boutons */
        .btn{
            display:inline-block;
            padding:6px 10px;
            border-radius:6px;
            text-decoration:none;
            color:#fff;
            background:#2563eb;
            font-size:0.9rem;
        }

        .btn-delete {
            background:#ef4444; /* rouge */
        }
        .btn-delete:hover {
            background:#dc2626;
        }

        /* champ de recherche */
        .search-box {
            display:flex;
            align-items:center;
            gap:8px;
            margin-bottom:12px;
        }
        .search-box input {
            flex:1;
            padding:6px 8px;
            border:1px solid #ddd;
            border-radius:6px;
            font-size:0.95rem;
        }

        /* bouton flottant vers l'accueil */
        .home-btn{
            position:fixed;
            right:20px;
            bottom:20px;
            z-index:999;
            display:inline-flex;
            align-items:center;
            gap:8px;
            padding:10px 14px;
            background:#10b981;
            color:#fff;
            text-decoration:none;
            border-radius:999px;
            box-shadow:0 8px 24px rgba(16,185,129,0.18);
            font-weight:700;
            font-size:0.95rem;
        }
        .home-btn:hover{background:#0ea96f}
        .home-btn:focus{outline:2px solid rgba(16,185,129,0.25);outline-offset:4px}
        .home-icon{width:16px;height:16px;display:inline-block;flex:0 0 16px}
    </style>
</head>
<body>
<div class="box">
    <h1>Entreprises</h1>

    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Rechercher une entreprise...">
    </div>

    <div id="list">
        <div class="empty">Chargement...</div>
    </div>
</div>

<!-- Bouton accueil -->
<a href="/" class="home-btn" aria-label="Aller Ã  l'accueil">
    <span class="home-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 9.5L12 3l9 6.5V20a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1V9.5z"/>
        </svg>
    </span>
    Accueil
</a>

<script>
    let allCompanies = [];

    // ðŸ”¹ RÃ©cupÃ©ration de la liste
    fetch('/api/companies')
        .then(r => r.ok ? r.json() : Promise.reject('Erreur serveur'))
        .then(companies => {
            allCompanies = companies || [];
            renderList(allCompanies);
        })
        .catch(() => {
            document.getElementById('list').innerHTML = '<div class="empty">Impossible de charger la liste</div>';
        });

    // ðŸ”¹ Fonction dâ€™affichage de la liste
    function renderList(companies) {
        const container = document.getElementById('list');
        if (!companies || companies.length === 0) {
            container.innerHTML = '<div class="empty">Aucune entreprise</div>';
            return;
        }

        let html = '<ul>';
        companies.forEach(c => {
            html += `
      <li>
        <span>${c.name}</span>
        <a href="#" class="btn btn-delete" onclick="deleteCompany(${c.id});return false;">Supprimer</a>
      </li>`;
        });
        html += '</ul>';
        container.innerHTML = html;
    }

    // ðŸ”¹ Recherche dynamique
    document.getElementById('searchInput').addEventListener('input', function() {
        const q = this.value.toLowerCase().trim();
        const filtered = allCompanies.filter(c => c.name.toLowerCase().includes(q));
        renderList(filtered);
    });

    // ðŸ”¹ Suppression d'une entreprise
    async function deleteCompany(id) {
        if (!confirm("Voulez-vous vraiment supprimer cette entreprise ?")) return;
        try {
            const res = await fetch(`/companies/${id}`, { method: 'DELETE' });
            if (!res.ok) throw new Error('Erreur serveur');
            allCompanies = allCompanies.filter(c => c.id !== id);
            renderList(allCompanies);
            alert("Entreprise supprimÃ©e !");
        } catch (err) {
            alert("Erreur: " + err.message);
        }
    }
</script>
</body>
</html>
